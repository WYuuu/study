# Table of Contents

* [Raft选举过程涉及三种角色和任期（Term）：](#raft选举过程涉及三种角色和任期term)
* [**领导选举过程**](#领导选举过程)


Nacos作为配置中心的功能是基于**Raft算法**来实现的。

Raft 算法是分布式系统开发首选的共识算法，它通过“一切以领导者为准”的方式，实现一系列值的共识和各节点日志的一致。

> 人人都想当领导



# Raft选举过程涉及三种角色和任期（Term）：

- `Follower`：默默地接收和处理来自Leader的消息，当等待Leader心跳信息超时的时候，就主动站出来，推荐自己当Candidate。
- `Candidate`：向其他节点发送投票请求，通知其他节点来投票，如果赢得了大多数（N/2+1）选票，就晋升Leader。
- `Leader`：负责处理客户端请求，进行日志复制等操作，每一轮选举的目标就是选出一个领导者；领导者会不断地发送心跳信息，通知其他节点“我是领导者，我还活着，你们不要发起新的选举，不用找个新领导者来替代我。”
- `Term`：这跟民主社会的选举很像，每一届新的履职期称之为一届任期



# **领导选举过程**

1. 在初始时，集群中所有的节点都Follower状态，都被设定一个随机选举超时时间（一般150ms-300ms）：

![image-20220422091646886](.images/image-20220422091646886.png)

2. 如果Follower在规定的超时时间，都没有收到来自Leader的心跳，它就发起选举：将自己的状态切为 Candidate，增加自己的任期编号，然后向集群中的其它Follower节点发送请求，询问其是否选举自己成为Leader：

   ![image-20220422091725355](.images/image-20220422091725355.png)

3. 其他节点收到候选人A的请求投票消息后，如果在编号为1的这届任期内还没有进行过投票，那么它将把选票投给节点A，并增加自己的任期编号：

   ![image-20220422091735099](.images/image-20220422091735099.png)

4. 收到来自集群中过半节点的接受投票后，A节点即成为本届任期内 Leader，他将周期性地发送心跳消息，通知其他节点我是Leader，阻止Follower发起新的选举：

![image-20220422091744189](.images/image-20220422091744189.png)

