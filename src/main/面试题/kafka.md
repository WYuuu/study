# Table of Contents

* [为什么要有消息系统](#为什么要有消息系统)
* [KafKa顺序写保证写数据性能](#kafka顺序写保证写数据性能)
* [Kafka副本机制保证高可用](#kafka副本机制保证高可用)
* [什么是Rebalance](#什么是rebalance)
* [kafka什么时候会重复消费](#kafka什么时候会重复消费)
* [kafak如何保证消息的有序性](#kafak如何保证消息的有序性)
  * [场景：还有一种消息ABC过来是有序的，但是我们消息A消息的时候处理超时了，此时B又过来了，还要保持有序就](#场景还有一种消息abc过来是有序的但是我们消息a消息的时候处理超时了此时b又过来了还要保持有序就)



[AREADME](../学习/I.分布式/kafka/AREADME.md)


# 为什么要有消息系统



异步 削峰 解耦



# KafKa顺序写保证写数据性能



kafka写数据：顺序写，往磁盘上写数据时，就是追加数据，没有随机写的操作。经验：如果一个服务器磁盘达到一定的个数，磁盘也达到一定转数，往磁盘里面顺序写（追加写）数据的速度和写内存的速度差不多。

生产者生产消息，经过kafka服务先写到os cache 内存中，然后经过sync顺序写到磁盘上


# Kafka副本机制保证高可用

在kafka里面分区是有副本的，注：0.8以前是没有副本机制的。创建主题时，可以指定分区，也可以指定副本个数。副本是有角色的：leader partition：1、写数据、读数据操作都是从leader partition去操作的。2、会维护一个ISR（in-sync- replica ）列表，但是会根据一定的规则删除ISR列表里面的值 生产者发送来一个消息，消息首先要写入到leader partition中 写完了以后，还要把消息写入到ISR列表里面的其它分区，写完后才算这个消息提交 follower partition：从leader partition同步数据。



# 什么是Rebalance



**rebalance（重平衡）其实就是重新进行 partition 的分配，从而使得 partition 的分配重新达到平衡状态。**



[Rebalance](../学习/I.分布式/kafka/Kafak-Rebalance问题处理.md)




# kafka什么时候会重复消费

导致kafka的重复消费问题原因在于，已经消费了数据，但是offset没来得及提交（比如Kafka没有或者不知道该数据已经被消费）



+ 设置为自动提交，kafka没有提交，被强制关闭
+ 发生Rebalance





# kafak如何保证消息的有序性

Kfka是无法保证全局的消息顺序性的，只能保证主题的某个分区的消息顺序性。

> 一个配置  和 幂等性 



+ 一个主题一个分区: 全部有序

  ​	但是会降低性能。

+ 一个主题多个分区：局部有序

  1. 将数据特性一样的hash，这样可以发到不同分区，消费者在消费



## 场景：还有一种消息ABC过来是有序的，但是我们消息A消息的时候处理超时了，此时B又过来了，还要保持有序就

先写接口表

在处理业务表
